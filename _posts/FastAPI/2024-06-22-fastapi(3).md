---
title: âš¡ FastAPI - Circular import
date: 2024-06-22 00:00:00 +0800
toc: true
pin: false
published: true
categories: [SERVER, FASTAPI]
tags: [fastapi]
image: https://github.com/Jng-su/Jng-su/assets/168960634/22fbcb9b-a69d-4154-9519-07c66b8a7681
---

<br>

---

> ## Circular import

<br>

![circular](https://github.com/Jng-su/Jng-su/assets/168960634/db9bdcd0-77b8-4f1d-83af-caa21d4450aa){: width="500" height="500" .normal}

<br>

ìˆœí™˜ì°¸ì¡°ë€ ìˆ˜ì§ê´€ê³„ê°€ ì•„ë‹Œ ìˆ˜í‰ê´€ê³„ì—ì„œ ë‘ í´ë˜ìŠ¤ê°„ ì„œë¡œì˜ í´ë˜ìŠ¤ë¥¼ ê° ì°¸ì¡°í•˜ë ¤ê³  í•˜ë©´ ë©”ì†Œë“œ í˜¸ì¶œí• ë•Œë§ˆë‹¤ ì—ëŸ¬ê°€ ë°œìƒí•¨

<br>

### Problem

ì˜ˆë¥¼ ë“¤ì–´ `User` í´ë˜ìŠ¤ì™€ `Cash` í´ë˜ìŠ¤ê°€ ì„œë¡œ ì°¸ì¡°í•˜ê³  ìˆëŠ” ìƒí™©

#### ğŸ“Ÿ `app.Models.user_model.py`

```python
class User(UserBase, table=True):
    __tablename__ = "user"

    id: int = Field(default=None, primary_key=True)

    cash: list["Cash"] = Relationship(back_populates="user")
```

#### ğŸ“Ÿ `app.Models.cash_model.py`

```python
class Cash(CashBase, table=True):
    __tablename__ = "cash"

    id: int = Field(default=None, primary_key=True)

    user_id: int = Field(foreign_key="user.id")
    user: Optional["User"] = Relationship(back_populates="cash")
```

ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œì 
1. ì´ˆê¸°í™” ë¬¸ì œ : ê°ì²´ ì´ˆê¸°í™” ìˆœì„œì— ë”°ë¼ ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ
2. ë¬´í•œ ë£¨í”„ : ê°ì²´ê°€ ì„œë¡œ í˜¸ì¶œë˜ë©´ì„œ ë¬´í•œ ë£¨í”„ì— ë¹ ì§.

### Solution

SQLModel ì—ì„œ ì œê³µí•˜ëŠ” `model_rebuild()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆìŒ

<br>

`model_rebuild()` ëŠ” í´ë˜ìŠ¤ ì •ì˜ë¥¼ ë‹¤ì‹œ êµ¬ì¶•í•˜ê³  í•„ìš”í•œ ê²½ìš° ì°¸ì¡°ë˜ëŠ” ë‹¤ë¥¸ í´ë˜ìŠ¤ì˜ ì •ì˜ë¥¼ ì°¾ì•„ ìˆœí™˜ ì°¸ì¡°ë¥¼ í•´ê²°í•¨

<br>

#### ğŸ“Ÿ `app.Models.__init__.py`

```python
from app.Models.user_model import User
from app.Models.cash_model import Cash

User.model_rebuild()
Cash.model_rebuild()
```