---
title: âš¡ FastAPI | Initial Setting
date: 2024-06-20 00:00:00 +0800
toc: true
pin: false
published: true
categories: [SERVER, FASTAPI]
tags: [fastapi]
image: https://github.com/Jng-su/Jng-su/assets/168960634/22fbcb9b-a69d-4154-9519-07c66b8a7681
---

<br>

---

<br>

[https://fastapi.tiangolo.com/tutorial/](https://fastapi.tiangolo.com/tutorial/)

<br>

> ## FastAPI

<br>

### ê°€ìƒí™˜ê²½ ì„¸íŒ… (Windows)

- ê°€ìƒí™˜ê²½ ìƒì„±

```shell
python -m venv ./venv
```

- ê°€ìƒí™˜ê²½ ë“¤ì–´ê°€ê¸°

```shell
source ./venv/Scripts/activate
```

- ê°€ìƒí™˜ê²½ ë‚˜ì˜¤ê¸°

```shell
deactivate
```

<br>

### í”„ë¡œì íŠ¸ ì„¤ì¹˜í•˜ê¸°

- FastAPI, uvicorn ì„¤ì¹˜

```shell
pip insatll fastapi "uvicorn[standard]"
```

<br>

- (í•„ìš”ì‹œ) python version ì—…ê·¸ë ˆì´ë“œ

```shell
python.exe -m pip install --upgrade pip
```

<br>

- ì˜ì¡´ì„± ì„¤ì¹˜ë¥¼ ìœ„í•œ íŒŒì¼ ì„¤ì¹˜

```shell 
pip freeze > requirements.txt
```

<br>

### í”„ë¡œì íŠ¸ ì‹œì‘í•˜ê¸°

```python
from fastapi import FastAPI

app = FastAPI()


@app.get("/")
async def root():
    return {"message": "Hello World"}
```

<br>

```shell
1. fastapi dev main.py
2. uvicron main:app --reload
```

<br>

> ## Folder Structure

<br>

```
server/
â”œâ”€â”€ main.py
â”œâ”€â”€ database.py
â”œâ”€â”€ database.db
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”œâ”€â”€ cash_model.py
â”‚   â”œâ”€â”€ Routers/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ cash_router.py
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”œâ”€â”€ cash_service.py
```

<br>

> ## Connect Database

<br>

```shell 
pip install sqlmodel
```

<br>

### ğŸ“Ÿ `.database.py`

```python
from sqlmodel import create_engine, SQLModel, Session

SQLALCHEMY_DATABASE_URL = "sqlite:///database.db"
engine = create_engine(SQLALCHEMY_DATABASE_URL, echo=True)
def create_db_and_tables():
    SQLModel.metadata.create_all(engine)

# SQLAlchemy ì—”ì§„ê³¼ì˜ ì—°ê²°ì„ í†µí•´ DB ì„¸ì…˜ì„ ìƒì„±í•˜ê³  ë°˜í™˜í•¨
def get_db():
    db = Session(bind=engine, autocommit=False, autoflush=False)
    try:
        yield db
    finally:
        db.close()
```

<br>

### ğŸ“Ÿ `.main.py`

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from database import create_db_and_tables
from contextlib import asynccontextmanager
from app.Routers import routers

# Create database tables
@asynccontextmanager
async def lifespan(app: FastAPI):
    create_db_and_tables()
    print("ğŸš€ Database connection created")
    yield
    print("ğŸš€ Database connection closed")

# Create FastAPI app instance
app = FastAPI(lifespan=lifespan)

# CORS settings
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

app.include_router(routers)
```

- `SQLModel.metadata.create_all(engine)` : SQLAlchemyì˜ `create_all` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ëª¨ë“  í…Œì´ë¸”ì„ ìƒì„±í•¨
  - `SQLModel` ì—ì„œ ìë™ìœ¼ë¡œ ìƒì„±ëœ MetaData ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ DB ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•˜ê³  DBì— í…Œì´ë¸”ì„ ìƒì„±í•¨
  - `create_all(engine)` ì€ DBì™€ì˜ ì—°ê²°ì„ ê´€ë¦¬í•˜ê³  í…Œì´ë¸”ì´ ì¡´ì¬í•˜ë©´ ì•„ë¬´ ì‘ì—…ë„ í•˜ì§€ ì•ŠìŒ.

<br>

ì¿¼ë¦¬ë¬¸ì€ ë‚˜ì¤‘ì— ğŸ‘‹