---
title: ğŸ¤– deeplearning - deepface [1]
date: 2024-08-19 00:00:00 +0800
toc: true
pin: false
published: true
categories: [AI, DEEPFACE]
tags: [deeplearning]
image: https://github.com/user-attachments/assets/a0e29a71-14c8-478c-9780-7c9928fb7cc7
---

<br>

---

<br>

python version : 3.10.12
runtime : GPU T4

ëª©ì  : ë”¥ëŸ¬ë‹ì˜ deepfaceí”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•œ ì•ˆë©´ ì¸ì‹ ì• í”Œë¦¬ì¼€ì´ì…˜

<br>

> ## deepface

ë”¥ëŸ¬ë‹ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì–¼êµ´ ê²€ì¶œ ë° ì¸ì‹, ê·¸ë¦¬ê³  ë‚˜ì´/ì„±ë³„/ê°ì • ë“± ì–¼êµ´ ë¶„ì„ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” Python ì–¼êµ´ì¸ì‹ í”„ë ˆì„ì›Œí¬
[https://github.com/serengil/deepface](https://github.com/serengil/deepface)

<br>

1. Face Detection : ì…ë ¥ëœ ì´ë¯¸ì§€ì˜ ì–¼êµ´ ì˜ì—­ë§Œ ì°¾ì•„ ì¶”ì¶œ
2. Face Alignment : ì¶”ì¶œí•œ ì–¼êµ´ì˜ ëœë“œë§ˆí¬ (ëˆˆ, ì½”, ì…, ì–¼êµ´ í˜•íƒœ ë“±) ì¶”ì¶œ
3. Face Normalization : ëœë“œë§ˆí¬ í¬ì¸íŠ¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì–¼êµ´ í˜•íƒœë¥¼ íšŒì „ì‹œí‚¤ê³  ì–¼êµ´ ë§¤ì¹­ì´ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë³€ê²½
4. Face Representation : ì„ë² ë”© ê³¼ì •ì„ ê±°ì³ íŠ¹ì§• ë²¡í„°ë¡œ í‘œí˜„ (ê³ ì°¨ì› -> ì €ì°¨ì› ê³µê°„), ì¼ì • í¬ê¸°ì˜ ë²¡í„°ë¡œ ë³€í™˜, ì¸ì‹ì— í•„ìš”í•œ ì •ë³´ë§Œ ë‚¨ê¹€. ì´ ê³¼ì •ì„ ê±°ì¹œ íŠ¹ì§• ë²¡í„°ëŠ” ì‚¬ëŒë§ˆë‹¤ ê³ ìœ ì˜ ê°’ì„ ê°€ì§€ë¯€ë¡œ ì´í›„ ì„œë¡œ ë¹„êµí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¹„êµ
5. Face Matching : ì…ë ¥ëœ ì´ë¯¸ì§€ íŠ¹ì§• ë²¡í„°ì˜ ìœ ì‚¬ë„ë¥¼ ê³„ì‚°

<br>

```python
pip install deepface
```

<br>

> ## Deepface models

Deepface í”„ë ˆì„ì›Œí¬ ì•ˆì—ëŠ” ë‹¤ì–‘í•œ ëª¨ë¸ì´ ì¡´ì¬í•œë‹¤. ëª¨ë¸ì„ ì„ ì •í•˜ê¸° ì•ì„œ ê° ëª¨ë¸ë“¤ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ì„±ëŠ¥ì´ ìš°ìˆ˜í•œ ëª¨ë¸ì„ íŒë³„í•˜ê³  ëª©ì ì— ë§ê²Œ ì—¬ëŸ¬ ëª¨ë¸ì„ ì‚¬ìš©í•  ê²ƒì„ ê³ ë ¤í•´ë´„.

ê° ëª¨ë¸ ë³„ë¡œ ìµœì ì˜ ì„ê³„ê°’ì´ ë‹¤ë¥´ê³  ë³´ì•ˆì´ ì¤‘ìš”í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ìš”êµ¬ì‚¬í•­ì—ì„œëŠ” ì„ê³„ê°’ì„ ë†’ì´ëŠ” ê²Œ ë§ì§€ë§Œ í˜„ì¬ëŠ” í…ŒìŠ¤íŠ¸ ìš©ë„ ì„ìœ¼ë¡œ ì„ê³„ê°’ì´ ë¹„êµì  ë‚®ì€ ëª¨ë¸ ì¤‘ì— Similarity ê°€ ë†’ì€ ëª¨ë¸ì„ ì„ ì •

<br>

- Distance : ë‘ ì–¼êµ´ ì„ë² ë”© ë²¡í„° ê°„ì˜ ê±°ë¦¬ ê°’ìœ¼ë¡œ, ë‘ ì–¼êµ´ì´ ë¹„ìŠ·í• ìˆ˜ë¡ ë‚®ì€ ê°’
- Similarity Score : ê±°ë¦¬ ê°’ì„ 1ì—ì„œ ëº€ ê°’ìœ¼ë¡œ, ë†’ì€ ê°’ì´ ë‘ ì–¼êµ´ì´ ìœ ì‚¬

<br>

### ë™ì¼ ì¸ë¬¼

```python
from deepface import DeepFace

# ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì •
image_path1 = "/content/drive/MyDrive/Deepface/data/Jennie (1).png"
image_path2 = "/content/drive/MyDrive/Deepface/data/Jennie (2).png"

# ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ëª¨ë¸ ë¦¬ìŠ¤íŠ¸
models = ["VGG-Face", "Facenet", "Facenet512", "ArcFace", "SFace", "GhostFaceNet"]

# ëª¨ë¸ë³„ë¡œ ì–¼êµ´ ì¸ì¦ ìˆ˜í–‰
for model_name in models:
    print(f'\n{"="*60}\n\nTesting model: {model_name}')

    try:
        # ì–¼êµ´ ì¸ì¦ ìˆ˜í–‰
        verification_result = DeepFace.verify(
            img1_path=image_path1,
            img2_path=image_path2,
            model_name=model_name
        )

        # ê±°ë¦¬ ê°’ì„ ìœ ì‚¬ë„ ì ìˆ˜ë¡œ ë³€í™˜
        distance = verification_result['distance']
        similarity_score = 1 - distance

        # ê²°ê³¼ ì¶œë ¥
        print(f"Distance : {distance:.4f}")
        print(f"Similarity Score : {similarity_score:.4f}")
        print(f"Match : {verification_result['verified']}")

    except Exception as e:
        print(f"Error with {model_name}: {str(e)}")

print(f'\n{"="*60}')
```

```plaintext
============================================================

Testing model: VGG-Face
Distance : 0.5633
Similarity Score : 0.4367
Match : True

============================================================

Testing model: Facenet
Distance : 0.2562
Similarity Score : 0.7438
Match : True

============================================================

Testing model: Facenet512
Distance : 0.2674
Similarity Score : 0.7326
Match : True

============================================================

Testing model: ArcFace
Distance : 0.4171
Similarity Score : 0.5829
Match : True

============================================================

Testing model: SFace
Distance : 0.3793
Similarity Score : 0.6207
Match : True

============================================================

Testing model: GhostFaceNet
Distance : 0.5032
Similarity Score : 0.4968
Match : True

============================================================
```

ìœ„ ëª¨ë¸ë“¤ ì¤‘ Similarityê°€ ê·¸ë‚˜ë§ˆ 0.7 ì´ìƒì¸ Facenet, Facenet512ê°€ ì„±ëŠ¥ì´ ì¢‹ì•„ë³´ì„

<br>

### ë‹¤ë¥¸ ì¸ë¬¼

```python
from deepface import DeepFace

# ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì •
image_path1 = "/content/drive/MyDrive/Deepface/data/Jennie (1).png"
image_path2 = "/content/drive/MyDrive/Deepface/data/Chaewon (1).png"

# ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ëª¨ë¸ ë¦¬ìŠ¤íŠ¸
models = ["VGG-Face", "Facenet", "Facenet512", "ArcFace", "SFace", "GhostFaceNet"]

# ëª¨ë¸ë³„ë¡œ ì–¼êµ´ ì¸ì¦ ìˆ˜í–‰
for model_name in models:
    print(f'\n{"="*60}\n\nTesting model: {model_name}')

    try:
        # ì–¼êµ´ ì¸ì¦ ìˆ˜í–‰
        verification_result = DeepFace.verify(
            img1_path=image_path1,
            img2_path=image_path2,
            model_name=model_name
        )

        # ê±°ë¦¬ ê°’ì„ ìœ ì‚¬ë„ ì ìˆ˜ë¡œ ë³€í™˜
        distance = verification_result['distance']
        similarity_score = 1 - distance

        # ê²°ê³¼ ì¶œë ¥
        print(f"Distance : {distance:.4f}")
        print(f"Similarity Score : {similarity_score:.4f}")
        print(f"Match : {verification_result['verified']}")

    except Exception as e:
        print(f"Error with {model_name}: {str(e)}")

print(f'\n{"="*60}')
```

```plaintext
============================================================

Testing model: VGG-Face
Distance : 0.9644
Similarity Score : 0.0356
Match : False

============================================================

Testing model: Facenet
Distance : 0.8328
Similarity Score : 0.1672
Match : False

============================================================

Testing model: Facenet512
Distance : 0.8079
Similarity Score : 0.1921
Match : False

============================================================

Testing model: ArcFace
Distance : 0.9558
Similarity Score : 0.0442
Match : False

============================================================

Testing model: SFace
Distance : 0.9782
Similarity Score : 0.0218
Match : False

============================================================

Testing model: GhostFaceNet
Distance : 1.0475
Similarity Score : -0.0475
Match : False

============================================================
```

ê²°ê³¼ëŠ” Falseë¡œ ì¼ì¹˜ í–ˆì§€ë§Œ ìœ ì‚¬ë„ ì—­ì‹œ ì°¨ì´ë¥¼ ë³´ì´ëŠ” ê±° ê°™ìŒ.
ê·¸ ì¤‘ Facenet, Facenet512ëŠ” ë‹¤ë¥¸ ëª¨ë¸ë“¤ì— ë°˜í•´ ìœ ì‚¬ë„ê°€ ë†’ìŒ

<br>

> ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê±°ì§“ ìŒì„±ì„ ìµœì†Œí™”, ì°¸ì„ ì¤‘ìš”ì‹œ í•˜ê¸°ì— ì˜ë„ì ì¸ ì°¸ê³¼ ê±°ì§“ ë°ì´í„°ë¥¼ ì œê³µí•œ ê²°ê³¼ Facenet ëª¨ë¸ì„ ì„ ì •í•˜ê² ìŒ.
{: .prompt-info }

<br>

> ## Images test

ì´ í…ŒìŠ¤íŠ¸ì˜ ëª©ì ì€ ì•ˆë©´ ì¸ì‹ ì‹œ ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ì…ë ¥ë°›ê³  ì°¸ê³¼ ê±°ì§“ì„ íŒë³„í•˜ëŠ” ëª©ì 

- ëª¨ë¸ì˜ ì‹ ë¢°ë„ë¥¼ ë†’ì´ê³  ì—¬ëŸ¬ ë‹¤ì–‘í•œ ì´ë¯¸ì§€ë¥¼ í…ŒìŠ¤íŠ¸ í•¨ìœ¼ë¡œì¨ íš¨ê³¼ë¥¼ ë†’ì´ê³  íŠ¹ì • ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ì„±ëŠ¥ ì €í•˜ ì—¬ë¶€ íŒë‹¨
- ì¶”í›„ ì˜ˆìƒë˜ëŠ” ê²°ê³¼ì™€ ë‹¤ë¥¼ ì‹œ ì¶”ê°€ ë°ì´í„°ì…‹ì„ í™•ë³´í•˜ê³  ëª¨ë¸ì˜ í•™ìŠµì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŒ.

<br>

```python
import os
from deepface import DeepFace

# ê¸°ì¤€ ì´ë¯¸ì§€ ê²½ë¡œ
base_image_path = "/content/drive/MyDrive/Deepface/data/Jennie (1).png"

# ë¹„êµí•  ì´ë¯¸ì§€ ê²½ë¡œ ë°°ì—´
image_list = [
    "/content/drive/MyDrive/Deepface/data/Jennie (2).png",
    "/content/drive/MyDrive/Deepface/data/Jennie (3).png",
    "/content/drive/MyDrive/Deepface/data/Jennie (4).png",
    "/content/drive/MyDrive/Deepface/data/Chaewon (1).png",
    "/content/drive/MyDrive/Deepface/data/yoongai (1).png",
]

# ì‚¬ìš©í•  ëª¨ë¸ ì´ë¦„
model_name = "Facenet"
base_image_name = os.path.basename(base_image_path)

# ê¸°ì¤€ ì´ë¯¸ì§€ì™€ ê° ì´ë¯¸ì§€ì˜ ë¹„êµ ìˆ˜í–‰
for idx, image_path in enumerate(image_list):
    comparison_image_name = os.path.basename(image_path)

    print(f'\n{"="*60}\n\nTesting pair {idx + 1}: {base_image_name} vs {comparison_image_name}')

    try:
        # ì–¼êµ´ ì¸ì¦ ìˆ˜í–‰
        verification_result = DeepFace.verify(
            img1_path=base_image_path,
            img2_path=image_path,
            model_name=model_name
        )

        # ê±°ë¦¬ ê°’ì„ ìœ ì‚¬ë„ ì ìˆ˜ë¡œ ë³€í™˜
        distance = verification_result['distance']
        similarity_score = 1 - distance

        # ê²°ê³¼ ì¶œë ¥
        print(f"Distance : {distance:.4f}")
        print(f"Similarity Score : {similarity_score:.4f}")
        print(f"Match : {'True' if verification_result['verified'] else 'False'}")

    except Exception as e:
        print(f"Error with images {base_image_name} and {comparison_image_name}: {str(e)}")

print(f'\n{"="*60}')
```

```plaintext
============================================================

Testing pair 1: Jennie (1).png vs Jennie (2).png
Distance : 0.2562
Similarity Score : 0.7438
Match : True

============================================================

Testing pair 2: Jennie (1).png vs Jennie (3).png
Distance : 0.2239
Similarity Score : 0.7761
Match : True

============================================================

Testing pair 3: Jennie (1).png vs Jennie (4).png
Distance : 0.1580
Similarity Score : 0.8420
Match : True

============================================================

Testing pair 4: Jennie (1).png vs Chaewon (1).png
Distance : 0.8328
Similarity Score : 0.1672
Match : False

============================================================

Testing pair 5: Jennie (1).png vs yoongai (1).png
Distance : 0.6702
Similarity Score : 0.3298
Match : False

============================================================
```

<br>

> ## Deepface Libraries

### Connect Database

```python
#face recognition
dfs = DeepFace.find(
  img_path = "img1.jpg",
  db_path = "C:/workspace/my_db", 
  model_name = models[1],
)
```

- ìœ„ ì½”ë“œëŠ” Deepfaceì˜ find í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ DBì— ì ‘ê·¼í•˜ì—¬ `img1.jpg` ì˜ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒí•˜ì—¬ dbë‚´ ê°€ì¥ ìœ ì‚¬í•œ ì–¼êµ´ì„ ì°¾ëŠ”ë‹¤.

í˜„ì¬ DB ì—°ë™ì´ ì•ˆë˜ì–´ìˆì–´ ìƒëµ

<br>

### Facial Attribute Analysis

```python
import json
from deepface import DeepFace

# ë¶„ì„í•  ì´ë¯¸ì§€ ê²½ë¡œ
image_path = "/content/drive/MyDrive/Deepface/data/yoongai (2).png"

# ë¶„ì„í•  ì‘ì—… ì„¤ì •
attributes = ['age', 'gender', 'race', 'emotion']

# ë¶„ì„ ìˆ˜í–‰
results = DeepFace.analyze(image_path, actions=attributes)

# ê²°ê³¼ ì¶œë ¥
def print_analysis_results(results):
    for result in results:
        print(f"\n{'='*60}\n")

        # age
        if 'age' in result:
            age = result['age']
            print(f"Age: {age}")

        # gender
        if 'gender' in result:
            gender = result['gender']
            print(f"Gender: {result['dominant_gender']}")
            print(f"Gender Probabilities: {', '.join([f'{g}: {p:.2f}%' for g, p in gender.items()])}\n")

        # race
        if 'race' in result:
            race = result['race']
            print(f"Race: {result['dominant_race']}")
            print(f"Race Probabilities: {', '.join([f'{r}: {p:.2f}%' for r, p in race.items()])}\n")

        # emotion
        if 'emotion' in result:
            emotion = result['emotion']
            print(f"Emotion: {result['dominant_emotion']}")
            print(f"Emotion Probabilities: {', '.join([f'{e}: {p:.2f}%' for e, p in emotion.items()])}\n")

        print(f"{'='*60}")

print_analysis_results(results)
```

![yoongai (2)](https://github.com/user-attachments/assets/73e033f8-3b34-4b74-86bc-588cf211e203){: width="250" height="250" .normal}

```plaintext
============================================================

Age: 27
Gender: Woman
Gender Probabilities: Woman: 91.27%, Man: 8.73%

Race: asian
Race Probabilities: asian: 100.00%, indian: 0.00%, black: 0.00%, 
white: 0.00%, middle eastern: 0.00%, latino hispanic: 0.00%

Emotion: happy
Emotion Probabilities: angry: 0.00%, disgust: 0.00%, fear: 0.00%, 
happy: 99.78%, sad: 0.00%, surprise: 0.00%, neutral: 0.22%

============================================================
```